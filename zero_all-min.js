(function(e){function f(){this.__member={}}function c(b,g){var a=arguments.callee,c=typeof b;if("object"==c)for(var d in b)a.set(d,b[d]);else"string"==c&&a.set(b,g);return a}f.prototype={set:function(b,g){this.get(b)&&this.destroy(b);this.__member[b]=g;this.__onChange();return this},__onChange:function(){this.all=this.__getEvalCode()},get:function(b){return this.__member[b]},list:function(){var b=[],g;for(g in this.__member)b.push(g);return b},destroy:function(b){b in this.__member&&(delete this.__member[b],
this.__onChange())},exportTo:function(b,g){"string"==typeof b&&(b=[b]);var a=this;(b||this.list()).forEach(function(b){g[b]=a.get(b)})},run:function(b){var g=b.__args;g||(g=(g=b.toString().match(/\((.*)?\)/))&&g[1]?g[1].replace(/ /g,"").split(","):[],b.__args=g);0===g.length&&(g=this.list(),b=b.toString(),b=b.substr(b.indexOf("{")),b=eval("(function(){ return function("+g.join(",")+")"+b+"})()"));for(var a=[],c=0,d=g.length;c<d;c++)a.push(this.get(g[c]));b.apply({},a);return this},__getEvalCode:function(){var a=
[];this.list().forEach(function(g){a.push(g+"=$global.get('"+g+"')")});return"var "+a.join(",")+";"}};var d=new f,a;for(a in d)c[a]=d[a];d={};d.VariableManager=f;c("z",d);e.$global=c;e.$run=function(a){var g={};a.apply(g,arguments);return g}})(this);
$run(function(){eval($global.all);var e=function(){};e.info=function(){};e.warn=function(){};e.debug=function(){};e.error=function(){};if("undefined"!=typeof console){"function"==typeof console.log&&(e=function(a){console.log(a)});for(var f=["info","warn","error","debug"],c=f.length;c--;){var d=f[c-1];"function"==typeof console[d]&&(e[d]=function(a){return function(b){console[a](b)}}(d))}}$global("$log",e)});
$run(function(){function e(g,a){if(a instanceof Array)for(var b=0,c=a.length;b<c;b++)e(g,a[b]);else if(g.indexOf)-1==g.indexOf(a)&&g.push(a);else{for(c=g.length;c--;)if(g[c]==a)return;g.push(a)}}function f(g,a,b,c){for(;g;){if(!1===b.apply(c,[g]))return!1;g=g[a]}return!0}function c(){var g=arguments,a=g[0],b=typeof g[1];"string"==b?(b=g[1],g=g[2]||{},!g.hasOwnProperty("writable")&&(!g.set&&!g.get)&&(g.writable=!0),Object.defineProperty(a,b,g)):"object"==b&&z._everyKey(g[1],function(g,b){c(a,g,b)})}
function d(g,a){var c=d.caller,e=c==g.constructor?"constructor":void 0;e||z._everyKey(g,function(a){g[a]==c&&(e=a)},g);var f=null;b(g.__proto__||g.constructor.prototype,function(a){if(a=a[e])return f=a,!1});if("function"==typeof f)return f.apply(g,a||c.arguments)}function a(){return a.caller}eval($global.all);var b=void 0!=={}.__proto__?function(a,b,c){return f(a.__proto__,"__proto__",b,c)}:function(a,b,c){var d=a.constructor.prototype;d==a&&(d=a.constructor.baseProto);for(;d;){if(!1===b.apply(c,
[d]))return!1;d=d.constructor.baseProto}if(a.constructor!==Object&&!1===b.apply(c,[Object.prototype]))return!1};z._every=function(a,b,c){if(!a)return!0;for(var d=0,e=a.length;d<e;d++)if(!1===b.apply(c,[a[d]]))return!1;return!0};z._everyKey=function(a,b,c){if("function"!=typeof b)return!1;for(p in a)if(!1===b.apply(c,[p,a[p]]))return!1;return!0};z._trace=f;z._traceProto=b;z._uniqPush=e;z._slice=function(a,b){return Array.prototype.slice.call(a,b||0)};z._copy=function(a,b){for(var c in a)b[c]=a[c];
return b};z._merge=function(a,b){for(var c in a)c in b||(b[c]=a[c]);return b};z._keys=function(a){var b,c=[];for(b in a)c.push(b);return c};z._containsAll=function(a,b){for(var c=0,d=0,e=b.length;d<e;d++)if(-1!=a.indexOf(b[d]))c++;else return!1;return 0<c};z._isPrivate=function(a){return a.toString().match(/^_/)};z._array=function(a){return Array.prototype.slice.call(a,0)};z._isPlainObject=function(a){if("object"!=typeof a||!(a instanceof Object)||!Object.prototype.isPrototypeOf(a))return!1;var c=
0;b(a,function(){if(1<++c)return!1});return 1<c?!1:!0};$global("$implement",function(a,b){var c=b.__implns__;c?z._uniqPush(c,a):b.__implns__=a instanceof Array?a.slice(0):[a];return b});$global("$extend",function(a,b){var c=a.prototype,d=function(){};d.prototype=b.prototype;a.prototype=new d;d=a.prototype;c&&z._copy(c,d);d.constructor=a;a.baseProto=b.prototype});$global("$callbase",d);$global("$include",function(a,b,c){c=c||[];c=c.concat("onIncluded","__implns__");z._everyKey(a,function(a,d){-1==
c.indexOf(a)&&(b[a]=d)});a.onIncluded&&a.onIncluded.call(b)});$global("$enum",function(a){if(1==arguments.length&&"object"==typeof a)return a;var b={};z._every(arguments,function(a){b[a]={}});return b});$global("$property",c);$global("$fn",function(a,b){b&&(a.option=b);return a});$global("$fnself",a)});
$run(function(){function e(a,b,c){if(null!=a){var d=typeof a;"object"!=d&&"function"!=d&&(a=new (eval(d.charAt(0).toUpperCase()+d.slice(1)))(a));var f=(c=!0===c)?a:{target:a};c||z._everyKey(a,function(a,b){"function"==typeof b&&(f[a]=b.bind(f.target))});e.findWrapper(a,b).forEach(function(a){$include(a,f)});b||e.findWrapperNamesExcept(a,b).forEach(function(a){f[a]||(f[a]=function(){e(f,a,!0);return f})});return f}}function f(a,b){if(null!=a){var c=typeof a;"object"!=c&&"function"!=c&&(a=new (eval(c.charAt(0).toUpperCase()+
c.slice(1)))(a));a.target&&(a.originTarget=a.target);a.target=a;e.findWrapper(a,b).forEach(function(b){$include(b,a)});b||e.findWrapperNamesExcept(a,b).forEach(function(b){a[b]||(a[b]=function(){f(a,b);return a})});return a}}eval($global.all);e.getWrapperNamesExcept=function(a,b){var b=b||c,d=this.__wrapper[a],e=[];if(d){var e=b,f=[],h;for(h in d)e!==h&&f.push(h);e=f}return e};e.findWrapperNamesExcept=function(a,b){var b=b||c,d=typeof a,f=[];("object"===d||"function"===d)&&z._traceProto(a,function(a){var c=
e.getWrapperNamesExcept(a.constructor,b);z._uniqPush(f,c);if(a=a.__implns__)a=a.slice(0),a.forEach(function(a){c=e.getWrapperNamesExcept(a,b);z._uniqPush(f,c)})});return f.reverse()};var c="default";e.__wrapper={};e.regist=function(a,b,d){d=d||c;if(b instanceof Array)b.forEach(function(b){e.regist(a,b,d)});else{var f=this.__wrapper[b];f||(f=this.__wrapper[b]={"default":null});if(this.__wrapper[b][d])throw"name '"+d+"' has been registed.";this.__wrapper[b][d]=a}};e.setDefault=function(a,b){var d=this.getWrapper(a,
b);d&&(this.__wrapper[a][c]=d)};e.unregist=function(a,b){a&&b&&(a instanceof Array?a.forEach(function(a){e.unregist(a,b)}):(this.__wrapper[a][c]==this.getWrapper(a,b)&&this.setDefault(a,null),delete this.__wrapper[a][b]))};e.getWrapper=function(a,b){var b=b||c,d=this.__wrapper[a];if(d)return d[b]};e.findWrapper=function(a,b){var c=typeof a,d=[];("object"===c||"function"===c)&&z._traceProto(a,function(a){var c=e.getWrapper(a.constructor,b);c&&z._uniqPush(d,c);if(a=a.__implns__)a=a.slice(0),a.forEach(function(a){(c=
e.getWrapper(a,b))&&z._uniqPush(d,c)})});return d.reverse()};e.make=function(a){return{can:function(b,c){if("string"==typeof b)d(a,c,b);else if("object"==typeof b)for(var e in b)d(a,b[e],e);return this},lose:function(b){if("string"==typeof b){var d=e.getWrapper(a,c);d&&delete d[b]}else if("object"==typeof b)for(d in b){var b=d,f=e.getWrapper(a,c);f&&delete f[b]}return this}}};var d=function(a,b,d){if(d=d||b.name){var f=e.getWrapper(a,c);f?f[d]=b:(f={},f[d]=b,e.regist(f,a))}};e.sandbox=function(a){name=
name||action.name;return function(b){if(b)return e.wrap(a,action,name),b=b(),e.unwrap(a,name),b}};$implement({type:"function(o)",member:{regist:"function(wrapper, protocol, name)",unregist:"function(protocol, name)",getWrapper:"function(protocol, name)",findWrapper:"function(o, name)",setDefault:"function(protocol, name)",findWrapperNamesExcept:"function(o, exceptName)",getWrapperNamesExcept:"function(protocol, exceptName)"}},e);$implement({type:"function(o)"},f);$global("$",e);$global("$$",f)});
$run(function(){eval($global.all);var e={onIncluded:"[function()]"};z.IObject={__implns__:Array};z.IModule=e;$global("$module",function(f){$implement(e,f);return f})});
$run(function(){eval($global.all);var e={target:"object",get:"function(name)",set:"function(member, value)",invoke:"function(funcName, args)",callFn:"function(funcName, thisp/*, arg1, arg2,...**/)",applyFn:"function(funcName, thisp, args)",wrap:"function(wrapperName)",include:"function(module)",implement:"function(protocol)"},f=$module({onIncluded:function(){$implement(e,this)},get:function(c){return this.target[c]},set:function(c,d){this.target[c]=d;return this},invoke:function(c,d){return this.target[c].apply(this.target,
d)},callFn:function(c,d){return this.target[c].apply(d,z._slice(arguments,2))},applyFn:function(c,d,a){return this.target[c].apply(d,a)},wrap:function(c){$$(this,c);return this},implement:function(c){$implement(c,this.target);return this},include:function(c){$include(c,this.target);return this}});$.regist(f,Object);z.IMObject=e;z.MObject=f});
$run(function(){eval($global.all);var e={type:"function",member:{baseProto:{type:"object",required:!1},__implns__:{type:"Array",required:!1},__cls_implns__:{type:"Array",required:!1}}},f=$module({onIncluded:function(){this.__cls_implns__=[];this.implement(e)},extend:function(c){$extend(this.target,c);delete this.extend;return this},classImplement:function(c){this.target.__cls_implns__||(this.target.__cls_implns__=[]);z._uniqPush(this.target.__cls_implns__,c);return this.target},getClassImplns:function(){return this.target.__cls_implns__}});
$.regist(f,Function,"toClass");z.IClass=e;z.MClass=f;$global("$class",function(c){return $$(c).toClass()})});
$run(function(){function e(){console.info("Base() callee")}eval($global.all);var f={get:"function(name)",set:"function(name, value)",proto:"function",base:"function()",include:"function(module)",property:"function()",implement:"function(protocol)",getOwnImplns:"function()",getImplns:"function()"};e.prototype=$implement(f,{property:function(){$property.apply(this,[this].concat(z._slice(arguments)));return this},include:function(c){$include(c,this);return this},get:function(c){return this[c]},set:function(c,
d){this[c]=d},proto:void 0!={}.__proto__?function(){return this.__proto__}:function(){return this.constructor.prototype===this?this.constructor.baseProto:this.constructor.prototype},base:function(){var c=this.base.caller,d=null,a=null;if(!a){var b=this;z._everyKey(b,function(e){if(b[e]==c)return a=e,d=b.constructor.baseProto,!1},this);a||z._traceProto(this,function(b){z._everyKey(b,function(e){if(b.hasOwnProperty(e)&&b[e]==c)return d=b.constructor.baseProto,a=e,!1});b.constructor==c&&(a="constructor",
d=b.constructor.baseProto);if(d)return!1})}if(a&&d){var e=d[a];if(e&&"function"==typeof e)return e.apply(this,arguments)}},implement:function(c){$implement(c,this)},getOwnImplns:function(){return this.hasOwnProperty("__implns__")?this.__implns__.slice(0):[]},getImplns:function(){var c=this.getOwnImplns(),d=this.constructor.getClassImplns&&this.constructor.getClassImplns();d||(d=this.constructor.__class_implns__);d&&z._uniqPush(c,d);z._traceProto(this,function(a){a.hasOwnProperty("__implns__")&&(a=
a.__implns__)&&(c=c.concat(a))});return c}});e.prototype.constructor=e;e.baseProto=Object.prototype;$class(e);z.IBase=f;z.Base=e});
$run(function(){function e(c){var d={},a=typeof c;if("object"==a)return c;switch(a){case "string":d.typeOf=c;break;case "function":d.instanceOf=c;break;case "undefined":d.typeOf=a}$implement(f,d);return d}eval($global.all);var f={typeOf:"[string]",instanceOf:"[object]",prototypeOf:"[object]"};z.ITypeSpec=f;z.parseTypeSpec=e;$global("$is",function(c,d){if(null===c)return c===d;var c=e(c),a=c.typeOf;if(a&&(-1!=a.indexOf("function")&&(a="function"),typeof d!==a)||c.instanceOf&&!(d instanceof c.instanceOf))return!1;
if(a=c.prototypeOf)if(a instanceof Array){if(!z._every(a,function(a){return a.isPrototypeOf(d)}))return!1}else if(!a.isPrototypeOf(d))return!1;return!0})});
$run(function(){function e(c){var d=arguments.callee;if(c instanceof d)return c;var a=typeof c;"string"==a?z._copy(d.__parse(c),this):"object"==a?z._copy(c,this):"function"==a&&(this.type=c);z._merge(arguments.callee.option,this)}eval($global.all);var f={required:"boolean",type:[Object,Array],ownProperty:"boolean",check:"function(o, name)",value:Object};e.option={required:!0,type:null,ownProperty:!1};e.__parse=function(c){var d={},a=c.match(/^\[(.*)\]$/);a&&(d.required=!1,c=a[1]);d.type=-1!=c.indexOf("|")?
c.split("|"):c;return d};e.prototype=$implement(f,{check:function(c,d){var a=c[d];if(null==a)return!this.required;if(this.type){var b=this.type;if($is(Array,b)){for(var e=!1,f=0,i=b.length;f<i;f++)if($is(b[f],a)){e=!0;break}if(!e)return!1}else if(!$is(b,a))return!1}return this.ownProperty&&!c.hasOwnProperty(d)?!1:!0}});$class(e).extend(z.Base);z.MemberSpec=e});
$run(function(){function e(d,a){var b={base:null,freeze:!1};b.type=a||Object;b.member=d;d.member&&(z._copy(d,b),b.type=d.type||Object);b.type&&(b.type=z.parseTypeSpec(b.type));var e=z.MemberSpec,f,i=b.member;for(f in i){var h=i[f];h instanceof e||(i[f]=new e(h))}$implement(c,b);return b}function f(d,a){if(!d.__implns__||-1==d.__implns__.indexOf(c))d=e(d);if(d.base&&!f(d.base,a)||d.type&&!$is(d.type,a))return!1;if(d.member){var b,g=d.member;for(b in g)if(!g[b].check(a,b))return!1;if(d.freeze){var j=
{};z._trace(d,"base",function(a){z._merge(a.member,j)});for(b in a)if(!(b in j))return!1}}return!0}eval($global.all);var c=e({member:{base:"[object]",member:"[object]",type:z.ITypeSpec,freeze:"[boolean]"}});z.IInterface=c;$global("$protocol",e);$global("$support",f)});
$run(function(){eval($global.all);$global("$option",function(){var e=arguments,f=$fnself().caller,c=e[0]||f.arguments[0]||{},e=e[1]||f.option,d,a;for(d in e)f=e[d],a=typeof f,"object"==a?f.hasOwnProperty.required||(f.required=!1):"object"==a&&(e[d]={type:a,required:!1});d=$protocol(e);if($support(d,c)){d=d.member;for(var b in d)b in c||(c[b]=d[b].value);return c}throw"arguments invalid";})});
$run(function(){function e(c,d){var d=d||{},a=[],b,e,f,i;f=0;for(i=c.length;f<i;f++)b=c[f],e=typeof b,"function"==e?b.option?a.push({params:[Object],fn:b,useOption:!0}):a.push({params:[],fn:b,useOption:!1}):$is(Array,b)&&(e=b[1],$is(Array,e)?a.push({params:e,fn:b[0],useOption:!1}):z._isPlainObject(e)&&(b[0].option=b[1],a.push({params:[Object],fn:b[0],useOption:!0})));f=0;for(i=a.length;f<i;f++)b=a[f],e=b.params.length,d[e]||(d[e]=[]),d[e].push(b);return d}function f(c,d){var a=typeof d,b=typeof c;
if("string"!==b||"object"===c)if("object"===a||"function"===a){if($is(c,d))return!0}else{if({string:String,number:Number,"boolean":Boolean}[a]===c)return!0}else if(a==b)return!0;return!1}eval($global.all);$global("$overload",function(){var c=function(){var c=arguments,a;a:{a=c;if(c=c.callee.fnMap[a.length]){var b=a[0],e=1==a.length&&"object"===typeof b,j=0,i,h,n,l,k,j=0;for(i=c.length;j<i;j++)if(h=c[j],l=h.fn,k=h.params,h.useOption){if(e&&z._isPlainObject(b)&&(k=l.option,z._keys(k).length>=z._keys(b).length&&
$support(k,b))){a=l;break a}}else{var m=!0;h=0;for(n=k.length;h<n&&!(m=f(k[h],a[h]),!m);h++);if(m){a=l;break a}}}a=void 0}if(a)return a.apply(this,arguments)};c.fnMap=e(arguments);c.overload=function(c,a){if(c){var b=[];c&&a?b.push([c,a]):b.push(c);e(b,this.fnMap)}};return c})});
$run(function(){eval($global.all);var e={addListener:"function(event, listener)",on:"function(event, listener)",removeListener:"function(event, listener)",un:"function(event, listener)",getListerners:"function(event)",fire:"function(event, args)"},f=$module({onIncluded:function(){this.__listeners={};$implement(e,this)},on:this.addListener,addListener:function(c,d){var a=this.__listeners[c];a||(a=this.__listeners[c]=[]);a.push(d);return this},un:this.removeListener,removeListener:function(c,d){var a=
this.__listeners[c];if(a)return this.__listeners[c]=a.filter(function(a){return a!=d}),this},getListerners:function(c){return this.__listeners[c]},fire:function(c,d){this.getListerners(c).forEach(function(a){a(d)});return this}});z.MEvent=f});
$run(function(){eval($global.all);var e=$module({methods:function(){var e=this.allKeys(),c=this.target;return e.filter(function(d){return"function"==typeof c[d]})},publicMethods:function(){return this.methods().filter(function(e){return!z._isPrivate(e)})},privateMethods:function(){return this.methods().filter(function(e){return z._isPrivate(e)})},fields:function(){var e=this.allKeys(),c=this.target;return e.filter(function(d){return"function"!=typeof c[d]})},publicFields:function(){return this.fields().filter(function(e){return!z._isPrivate(e)})},
privateFields:function(){return this.fields().filter(function(e){return z._isPrivate(e)})},keys:function(){return Object.keys(this.target)},allKeys:function(){return z._keys(this.target)},type:function(){return typeof this.target},protoLink:function(){var e=[];z._traceProto(this.target,function(c){e.push(c)});return e},proto:function(){var e=this.target;return void 0!=={}.__proto__?e.__proto__:e.constructor.prototype},creator:function(){return this.target.constructor},implns:function(){var e=this.__implementions__;
return e?[]:e.slice(0)}});z.MInspect=e;$.regist(e,Object,"inspect");$global("$inspect",function(e){return $(e).inspect()})});
