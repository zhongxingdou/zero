(function(e){function g(){this.__member={}}function c(a,f){var b=arguments.callee,c=typeof a;if("object"==c)for(var d in a)b.set(d,a[d]);else"string"==c&&b.set(a,f);return b}g.prototype={set:function(a,f){this.get(a)&&this.destroy(a);this.__member[a]=f;this.__onChange();return this},__onChange:function(){this.all=this.__getEvalCode()},get:function(a){return this.__member[a]},list:function(){var a=[],f;for(f in this.__member)a.push(f);return a},destroy:function(a){a in this.__member&&(delete this.__member[a],
this.__onChange())},exportTo:function(a,f){"string"==typeof a&&(a=[a]);var b=this;(a||this.list()).forEach(function(a){f[a]=b.get(a)})},run:function(a){var f=a.__args;f||(f=(f=a.toString().match(/\((.*)?\)/))&&f[1]?f[1].replace(/ /g,"").split(","):[],a.__args=f);0===f.length&&(f=this.list(),a=a.toString(),a=a.substr(a.indexOf("{")),a=eval("(function(){ return function("+f.join(",")+")"+a+"})()"));for(var b=[],c=0,d=f.length;c<d;c++)b.push(this.get(f[c]));a.apply({},b);return this},__getEvalCode:function(){var a=
[];this.list().forEach(function(f){a.push(f+"=$global.get('"+f+"')")});return"var "+a.join(",")+";"}};var d=new g,b;for(b in d)c[b]=d[b];d={};d.VariableManager=g;c("z",d);e.$global=c;e.$run=function(a){var f={};a.apply(f,arguments);return f}})(this);
$run(function(){eval($global.all);var e=function(){};e.info=function(){};e.warn=function(){};e.debug=function(){};e.error=function(){};if("undefined"!=typeof console){"function"==typeof console.log&&(e=function(b){console.log(b)});for(var g=["info","warn","error","debug"],c=g.length;c--;){var d=g[c-1];"function"==typeof console[d]&&(e[d]=function(b){return function(a){console[b](a)}}(d))}}$global("$log",e)});
$run(function(){function e(f,a){if(a instanceof Array)for(var b=0,c=a.length;b<c;b++)e(f,a[b]);else if(f.indexOf)-1==f.indexOf(a)&&f.push(a);else{for(c=f.length;c--;)if(f[c]==a)return;f.push(a)}}function g(f,a,b,c){for(;f;){if(!1===b.apply(c,[f]))return!1;f=f[a]}return!0}function c(){var f=arguments,a=f[0],b=typeof f[1];"string"==b?(b=f[1],f=f[2]||{},!f.hasOwnProperty("writable")&&(!f.set&&!f.get)&&(f.writable=!0),Object.defineProperty(a,b,f)):"object"==b&&z._everyKey(f[1],function(f,b){c(a,f,b)})}
function d(f,b){var c=d.caller,e=c==f.constructor?"constructor":void 0;e||z._everyKey(f,function(a){f[a]==c&&(e=a)},f);var g=null;a(f.__proto__||f.constructor.prototype,function(f){if(f=f[e])return g=f,!1});if("function"==typeof g)return g.apply(f,b||c.arguments)}function b(){return b.caller}eval($global.all);var a=void 0!=={}.__proto__?function(f,a,b){return g(f.__proto__,"__proto__",a,b)}:function(f,a,b){var c=f.constructor.prototype;c==f&&(c=f.constructor.baseProto);for(;c;){if(!1===a.apply(b,
[c]))return!1;c=c.constructor.baseProto}if(f.constructor!==Object&&!1===a.apply(b,[Object.prototype]))return!1};z._every=function(f,a,b){if(!f)return!0;for(var c=0,d=f.length;c<d;c++)if(!1===a.apply(b,[f[c]]))return!1;return!0};z._everyKey=function(f,a,b){if("function"!=typeof a)return!1;for(p in f)if(!1===a.apply(b,[p,f[p]]))return!1;return!0};z._trace=g;z._traceProto=a;z._uniqPush=e;z._slice=function(a,b){return Array.prototype.slice.call(a,b||0)};z._copy=function(a,b){for(var c in a)b[c]=a[c];
return b};z._merge=function(a,b){for(var c in a)c in b||(b[c]=a[c]);return b};z._keys=function(a){var b,c=[];for(b in a)c.push(b);return c};z._containsAll=function(a,b){for(var c=0,d=0,e=b.length;d<e;d++)if(-1!=a.indexOf(b[d]))c++;else return!1;return 0<c};z._isPrivate=function(a){return a.toString().match(/^_/)};z._array=function(a){return Array.prototype.slice.call(a,0)};z._isPlainObject=function(b){if("object"!=typeof b||!(b instanceof Object)||!Object.prototype.isPrototypeOf(b))return!1;var c=
0;a(b,function(){if(1<++c)return!1});return 1<c?!1:!0};$global("$implement",function(a,b){var c=b.__implns__;c?z._uniqPush(c,a):b.__implns__=a instanceof Array?a.slice(0):[a];return b});$global("$extend",function(a,b){var c=a.prototype,d=function(){};d.prototype=b.prototype;a.prototype=new d;d=a.prototype;c&&z._copy(c,d);d.constructor=a;a.baseProto=b.prototype});$global("$callbase",d);$global("$include",function(a,b,c){c=c||[];c=c.concat("onIncluded","__implns__");z._everyKey(a,function(a,f){-1==
c.indexOf(a)&&(b[a]=f)});a.onIncluded&&a.onIncluded.call(b)});$global("$enum",function(a){if(1==arguments.length&&"object"==typeof a)return a;var b={};z._every(arguments,function(a){b[a]={}});return b});$global("$property",c);$global("$fn",function(a,b){b&&(a.option=b);return a});$global("$fnself",b)});
$run(function(){function e(b,a,c){if(null!=b){var d=typeof b;"object"!=d&&"function"!=d&&(b=new (eval(d.charAt(0).toUpperCase()+d.slice(1)))(b));var g=(c=!0===c)?b:{target:b};c||z._everyKey(b,function(a,b){"function"==typeof b&&(g[a]=b.bind(g.target))});e.findWrapper(b,a).forEach(function(a){$include(a,g)});a||e.findWrapperNamesExcept(b,a).forEach(function(a){g[a]||(g[a]=function(){e(g,a,!0);return g})});return g}}function g(b,a){if(null!=b){var c=typeof b;"object"!=c&&"function"!=c&&(b=new (eval(c.charAt(0).toUpperCase()+
c.slice(1)))(b));b.target&&(b.originTarget=b.target);b.target=b;e.findWrapper(b,a).forEach(function(a){$include(a,b)});a||e.findWrapperNamesExcept(b,a).forEach(function(a){b[a]||(b[a]=function(){g(b,a);return b})});return b}}eval($global.all);e.getWrapperNamesExcept=function(b,a){var a=a||c,f=this.__wrapper[b],d=[];if(f){var d=a,e=[],g;for(g in f)d!==g&&e.push(g);d=e}return d};e.findWrapperNamesExcept=function(b,a){var a=a||c,f=typeof b,d=[];("object"===f||"function"===f)&&z._traceProto(b,function(b){var c=
e.getWrapperNamesExcept(b.constructor,a);z._uniqPush(d,c);if(b=b.__implns__)b=b.slice(0),b.forEach(function(b){c=e.getWrapperNamesExcept(b,a);z._uniqPush(d,c)})});return d.reverse()};var c="default";e.__wrapper={};e.regWrapper=function(b,a,f){f=f||c;if(a instanceof Array)a.forEach(function(a){e.regWrapper(b,a,f)});else{var d=this.__wrapper[a];d||(d=this.__wrapper[a]={"default":null});if(this.__wrapper[a][f])throw"name '"+f+"' has been registered.";this.__wrapper[a][f]=b}};e.setDefault=function(b,
a){var f=this.getWrapper(b,a);f&&(this.__wrapper[b][c]=f)};e.removeWrapper=function(b,a){b&&a&&(b instanceof Array?b.forEach(function(b){e.removeWrapper(b,a)}):(this.__wrapper[b][c]==this.getWrapper(b,a)&&this.setDefault(b,null),delete this.__wrapper[b][a]))};e.getWrapper=function(b,a){var a=a||c,f=this.__wrapper[b];if(f)return f[a]};e.findWrapper=function(b,a){var c=typeof b,d=[];("object"===c||"function"===c)&&z._traceProto(b,function(b){var c=e.getWrapper(b.constructor,a);c&&z._uniqPush(d,c);if(b=
b.__implns__)b=b.slice(0),b.forEach(function(b){(c=e.getWrapper(b,a))&&z._uniqPush(d,c)})});return d.reverse()};e.make=function(b){return{can:function(a,c){if("string"==typeof a)d(b,c,a);else if("object"==typeof a)for(var e in a)d(b,a[e],e);return this},lose:function(a){if("string"==typeof a){var d=e.getWrapper(b,c);d&&delete d[a]}else if("object"==typeof a)for(d in a){var a=d,g=e.getWrapper(b,c);g&&delete g[a]}return this}}};var d=function(b,a,d){if(d=d||a.name){var g=e.getWrapper(b,c);g?g[d]=a:
(g={},g[d]=a,e.regWrapper(g,b))}};e.createSandbox=function(b,a){return function(c){if(c){e.make(b).can(a);var d;try{d=c()}finally{e.make(b).lose(a)}return d}}};e.onceWrap=function(b,a,c){return e.makeSandbox(b,a)(c)};$implement({type:"function(o)",member:{regWrapper:"function(wrapper, protocol, name)",removeWrapper:"function(protocol, name)",getWrapper:"function(protocol, name)",findWrapper:"function(o, name)",setDefault:"function(protocol, name)",findWrapperNamesExcept:"function(o, exceptName)",
getWrapperNamesExcept:"function(protocol, exceptName)"}},e);$implement({type:"function(o)"},g);$global("$",e);$global("$$",g)});$run(function(){eval($global.all);var e={onIncluded:"[function()]"};z.IObject={__implns__:Array};z.IModule=e;$global("$module",function(g){$implement(e,g);return g})});
$run(function(){eval($global.all);var e={target:"object",get:"function(name)",set:"function(member, value)",invoke:"function(funcName, args)",wrapWith:"function(wrapperName)",include:"function(module)",implement:"function(protocol)"},g=$module({onIncluded:function(){$implement(e,this)},get:function(c){return this.target[c]},set:function(c,d){this.target[c]=d;return this},invoke:function(c,d){return this.target[c].apply(this.target,d)},wrapWith:function(c){$$(this,c);return this},implement:function(c){$implement(c,
this.target);return this},include:function(c){$include(c,this.target);return this}});$.regWrapper(g,Object);z.IMObject=e;z.MObject=g});
$run(function(){eval($global.all);var e={type:"function",member:{baseProto:{type:"object",required:!1},__implns__:{type:"Array",required:!1},__cls_implns__:{type:"Array",required:!1}}},g=$module({onIncluded:function(){this.__cls_implns__=[];this.implement(e)},extend:function(c){$extend(this.target,c);delete this.extend;return this},classImplement:function(c){this.target.__cls_implns__||(this.target.__cls_implns__=[]);z._uniqPush(this.target.__cls_implns__,c);return this.target},getClassImplns:function(){return this.target.__cls_implns__}});
$.regWrapper(g,Function,"toClass");z.IClass=e;z.MClass=g;$global("$class",function(c){return $$(c).toClass()})});
$run(function(){function e(){console.info("Base() callee")}eval($global.all);var g={get:"function(name)",set:"function(name, value)",proto:"function",base:"function()",include:"function(module)",property:"function()",implement:"function(protocol)",getOwnImplns:"function()",getImplns:"function()"};e.prototype=$implement(g,{property:function(){$property.apply(this,[this].concat(z._slice(arguments)));return this},include:function(c){$include(c,this);return this},get:function(c){return this[c]},set:function(c,
d){this[c]=d},proto:void 0!={}.__proto__?function(){return this.__proto__}:function(){return this.constructor.prototype===this?this.constructor.baseProto:this.constructor.prototype},base:function(){var c=this,d=c.base.caller,b=null,a=null;a||(z._everyKey(c,function(f){if(c[f]==d)return a=f,b=c.constructor.baseProto,!1}),a||z._traceProto(c,function(c){z._everyKey(c,function(f){if(c.hasOwnProperty(f)&&c[f]==d)return b=c.constructor.baseProto,a=f,!1});c.constructor==d&&(a="constructor",b=c.constructor.baseProto);
if(b)return!1}));if(a&&b){var f=b[a];if(f&&"function"==typeof f)return f.apply(c,arguments)}},implement:function(c){$implement(c,this)},getOwnImplns:function(){return this.hasOwnProperty("__implns__")?this.__implns__.slice(0):[]},getImplns:function(){var c=this.getOwnImplns(),d=this.constructor.getClassImplns&&this.constructor.getClassImplns();d||(d=this.constructor.__class_implns__);d&&z._uniqPush(c,d);z._traceProto(this,function(b){b.hasOwnProperty("__implns__")&&(b=b.__implns__)&&(c=c.concat(b))});
return c}});e.prototype.constructor=e;e.baseProto=Object.prototype;$class(e);z.IBase=g;z.Base=e});
$run(function(){function e(c){var d={},b=typeof c;if("object"==b)return c;switch(b){case "string":d.typeOf=c;break;case "function":d.instanceOf=c;break;case "undefined":d.typeOf=b}$implement(g,d);return d}eval($global.all);var g={typeOf:"[string]",instanceOf:"[object]",prototypeOf:"[object]"};z.ITypeSpec=g;z.parseTypeSpec=e;$global("$is",function(c,d){if(null===c)return c===d;var c=e(c),b=c.typeOf;if(b&&(-1!=b.indexOf("function")&&(b="function"),typeof d!==b)||c.instanceOf&&!(d instanceof c.instanceOf))return!1;
if(b=c.prototypeOf)if(b instanceof Array){if(!z._every(b,function(a){return a.isPrototypeOf(d)}))return!1}else if(!b.isPrototypeOf(d))return!1;return!0})});
$run(function(){function e(c){var d=arguments.callee;if(c instanceof d)return c;var b=typeof c;"string"==b?z._copy(d.__parse(c),this):"object"==b?z._copy(c,this):"function"==b&&(this.type=c);z._merge(arguments.callee.option,this)}eval($global.all);var g={required:"boolean",type:[Object,Array],ownProperty:"boolean",check:"function(o, name)",value:Object};e.option={required:!0,type:null,ownProperty:!1};e.__parse=function(c){var d={},b=c.match(/^\[(.*)\]$/);b&&(d.required=!1,c=b[1]);d.type=-1!=c.indexOf("|")?
c.split("|"):c;return d};e.prototype=$implement(g,{check:function(c,d){var b=c[d];if(null==b)return!this.required;if(this.type){var a=this.type;if($is(Array,a)){for(var f=!1,e=0,g=a.length;e<g;e++)if($is(a[e],b)){f=!0;break}if(!f)return!1}else if(!$is(a,b))return!1}return this.ownProperty&&!c.hasOwnProperty(d)?!1:!0}});$class(e).extend(z.Base);z.MemberSpec=e});
$run(function(){function e(d,b){var a={base:null,freeze:!1};a.type=b||Object;a.member=d;d.member&&(z._copy(d,a),a.type=d.type||Object);a.type&&(a.type=z.parseTypeSpec(a.type));var f=z.MemberSpec,e,g=a.member;for(e in g){var h=g[e];h instanceof f||(g[e]=new f(h))}$implement(c,a);return a}function g(d,b){if(!d.__implns__||-1==d.__implns__.indexOf(c))d=e(d);if(d.base&&!g(d.base,b)||d.type&&!$is(d.type,b))return!1;if(d.member){var a,f=d.member;for(a in f)if(!f[a].check(b,a))return!1;if(d.freeze){var l=
{};z._trace(d,"base",function(a){z._merge(a.member,l)});for(a in b)if(!(a in l))return!1}}return!0}eval($global.all);var c=e({member:{base:"[object]",member:"[object]",type:z.ITypeSpec,freeze:"[boolean]"}});z.IInterface=c;$global("$protocol",e);$global("$support",g)});
$run(function(){eval($global.all);$global("$option",function(){var e=arguments,g=$fnself().caller,c=e[0]||g.arguments[0]||{},e=e[1]||g.option,d,b;for(d in e)g=e[d],b=typeof g,"object"==b?g.hasOwnProperty.required||(g.required=!1):"object"==b&&(e[d]={type:b,required:!1});d=$protocol(e);if($support(d,c)){d=d.member;for(var a in d)a in c||(c[a]=d[a].value);return c}throw"arguments invalid";})});
$run(function(){function e(c,d){var d=d||{},b=[],a,f,e,g;e=0;for(g=c.length;e<g;e++)a=c[e],f=typeof a,"function"==f?a.option?b.push({params:[Object],fn:a,useOption:!0}):b.push({params:[],fn:a,useOption:!1}):$is(Array,a)&&(f=a[1],$is(Array,f)?b.push({params:f,fn:a[0],useOption:!1}):z._isPlainObject(f)&&(a[0].option=a[1],b.push({params:[Object],fn:a[0],useOption:!0})));e=0;for(g=b.length;e<g;e++)a=b[e],f=a.params.length,d[f]||(d[f]=[]),d[f].push(a);return d}function g(c,d){var b=typeof d,a=typeof c;
if("string"!==a||"object"===c)if("object"===b||"function"===b){if($is(c,d))return!0}else{if({string:String,number:Number,"boolean":Boolean}[b]===c)return!0}else if(b==a)return!0;return!1}eval($global.all);$global("$overload",function(){var c=function(){var c=arguments,b;a:{b=c;if(c=c.callee.fnMap[b.length]){var a=b[0],f=1==b.length&&"object"===typeof a,e=0,m,h,n,j,i,e=0;for(m=c.length;e<m;e++)if(h=c[e],j=h.fn,i=h.params,h.useOption){if(f&&z._isPlainObject(a)&&(i=j.option,z._keys(i).length>=z._keys(a).length&&
$support(i,a))){b=j;break a}}else{var k=!0;h=0;for(n=i.length;h<n&&!(k=g(i[h],b[h]),!k);h++);if(k){b=j;break a}}}b=void 0}if(b)return b.apply(this,arguments)};c.fnMap=e(arguments);c.overload=function(c,b){if(c){var a=[];c&&b?a.push([c,b]):a.push(c);e(a,this.fnMap)}};return c})});
$run(function(){eval($global.all);var e={addListener:"function(event, listener)",on:"function(event, listener)",removeListener:"function(event, listener)",un:"function(event, listener)",getListerners:"function(event)",fire:"function(event, args)"},g=$module({onIncluded:function(){this.__listeners={};$implement(e,this)},on:this.addListener,addListener:function(c,d){var b=this.__listeners[c];b||(b=this.__listeners[c]=[]);b.push(d);return this},un:this.removeListener,removeListener:function(c,d){var b=
this.__listeners[c];if(b)return this.__listeners[c]=b.filter(function(a){return a!=d}),this},getListerners:function(c){return this.__listeners[c]},fire:function(c,d){this.getListerners(c).forEach(function(b){b(d)});return this}});z.MEvent=g});
$run(function(){eval($global.all);var e=$module({methods:function(){var e=this.allKeys(),c=this.target;return e.filter(function(d){return"function"==typeof c[d]})},publicMethods:function(){return this.methods().filter(function(e){return!z._isPrivate(e)})},privateMethods:function(){return this.methods().filter(function(e){return z._isPrivate(e)})},fields:function(){var e=this.allKeys(),c=this.target;return e.filter(function(d){return"function"!=typeof c[d]})},publicFields:function(){return this.fields().filter(function(e){return!z._isPrivate(e)})},
privateFields:function(){return this.fields().filter(function(e){return z._isPrivate(e)})},keys:function(){return Object.keys(this.target)},allKeys:function(){return z._keys(this.target)},type:function(){return typeof this.target},protoLink:function(){var e=[];z._traceProto(this.target,function(c){e.push(c)});return e},proto:function(){var e=this.target;return void 0!=={}.__proto__?e.__proto__:e.constructor.prototype},creator:function(){return this.target.constructor},implns:function(){var e=this.__implementions__;
return e?[]:e.slice(0)}});z.MInspect=e;$.regWrapper(e,Object,"inspect");$global("$inspect",function(e){return $(e).inspect()})});
